<picture>
  <source media="(prefers-color-scheme: dark)" srcset="https://github.com/CodeClarityCE/identity/blob/main/logo/vectorized/logo_name_white.svg">
  <source media="(prefers-color-scheme: light)" srcset="https://github.com/CodeClarityCE/identity/blob/main/logo/vectorized/logo_name_black.svg">
  <img alt="codeclarity-logo" src="https://github.com/CodeClarityCE/identity/blob/main/logo/vectorized/logo_name_black.svg">
</picture>

# CodeClarity Deployment Guide

**Secure your software, empower your team.**

[![License](https://img.shields.io/github/license/codeclarityce/codeclarity-dev)](LICENSE.txt)
[![Website](https://img.shields.io/badge/Website-Visit-blue)](https://www.codeclarity.io)

---

## 🚀 What is CodeClarity?

CodeClarity is a **powerful, open-source security analysis platform** that serves as an alternative to Snyk, Checkmarx, and Black Duck. It provides:

- **⚡ Fast source code analysis** - Identify dependencies, licenses, and vulnerabilities instantly
- **🏠 Full on-premises control** - Your code never leaves your environment
- **🔗 CI/CD integration** - Seamlessly integrates with GitHub Actions, Jenkins, and more
- **🧩 Extensible plugin system** - Create custom analysis pipelines with modular plugins
- **📊 Comprehensive reporting** - SBOM generation, vulnerability detection, license compliance

### Current Plugin Ecosystem

- **Built-in Plugins**: SBOM builder, vulnerability finder, license finder
- **External Integrations**: CodeQL support
- **Expanding Library**: More plugins coming soon

![CodeClarity Platform Overview](https://github.com/CodeClarityCE/identity/blob/main/illustration/rasterized/demo_illu.png)

<details open="open">
<summary>Table of Contents</summary>

- [CodeClarity Deployment Guide](#codeclarity-deployment-guide)
  - [🚀 What is CodeClarity?](#-what-is-codeclarity)
    - [Current Plugin Ecosystem](#current-plugin-ecosystem)
  - [📋 System Requirements](#-system-requirements)
  - [⚡ Quick Start Guide](#-quick-start-guide)
  - [🎉 Start Using the Platform](#-start-using-the-platform)
  - [🛠️ Detailed Setup Instructions](#️-detailed-setup-instructions)
    - [1. Download and Run the Setup Script](#1-download-and-run-the-setup-script)
    - [2. Choose Your Installation Method](#2-choose-your-installation-method)
      - [Option 1: Local Development Installation 🏠](#option-1-local-development-installation-)
      - [Option 2: Production/Server Installation 🌐](#option-2-productionserver-installation-)
        - [SSL Certificate Options](#ssl-certificate-options)
          - [Automatic Certificate Generation (Recommended) 🔐](#automatic-certificate-generation-recommended-)
          - [Custom Certificate Management 📜](#custom-certificate-management-)
    - [3. Update the Knowledge Database (Optional)](#3-update-the-knowledge-database-optional)
    - [4. Maintaining the Platform](#4-maintaining-the-platform)
  - [🤝 Contributing](#-contributing)
  - [🐛 Reporting Issues](#-reporting-issues)
  - [📄 License](#-license)

</details>

## 📋 System Requirements

Before you begin, make sure your system meets the following requirements:

- **curl**: For downloading the setup script and database dumps. [Install instructions](https://curl.se/download.html)
- **git**: Required for cloning the deployment repository and updating the platform. [Install instructions](https://git-scm.com/downloads)
- **openssl**: Required for generating SSL certificates. [Install instructions](https://www.openssl.org/source/)
- **Docker & Docker Compose**: Containerization platform and orchestration tool for running CodeClarity. [Docker install](https://docs.docker.com/engine/install/) | [Compose install](https://docs.docker.com/compose/install/)
- **make** (optional): Simplifies maintenance and update tasks. [Install instructions](https://www.gnu.org/software/make/)

> [!TIP]
> If you're new to Docker, check out the [Docker Get Started guide](https://docs.docker.com/get-started/) for a quick introduction.

## ⚡ Quick Start Guide

**Want to get started in 2 minutes?** Run this one-liner to install CodeClarity locally:

```bash
curl -O https://raw.githubusercontent.com/CodeClarityCE/deployment/main/setup.sh && bash setup.sh
```

When prompted, choose `Y` for localhost installation, and you'll have CodeClarity running at `https://localhost:443`!

> [!NOTE]
> For production deployments or custom configurations, follow the [detailed setup instructions](#️-detailed-setup-instructions) below.

---

## 🎉 Start Using the Platform

You're ready to access CodeClarity! Open [https://localhost:443](https://localhost:443) in your browser to get started.

> [!WARNING]
> Your browser may prompt you to accept the self-signed certificate generated by Caddy. This is expected for local installations.

> [!NOTE]
> To help you get started quickly, use the following credentials:
>
> - **Login:** `john.doe@codeclarity.io`
> - **Password:** `ThisIs4Str0ngP4ssW0rd?`

*We recommend changing your password after your first login.*

Ready to explore? Follow the [Create Your First Analysis](https://doc.codeclarity.io/docs/0.0.21/tutorials/basic/create-analysis) guide to begin analyzing your code!

## 🛠️ Detailed Setup Instructions

This repository contains all the configuration files needed to deploy CodeClarity. The setup process is designed to be simple and guides you through different deployment scenarios.

### 1. Download and Run the Setup Script

This script will automatically clone the deployment repository and guide you through the initial setup of CodeClarity.

> [!WARNING]
> Please make sure the Docker daemon is running before executing the setup script.

```bash
curl -O https://raw.githubusercontent.com/CodeClarityCE/deployment/main/setup.sh && bash setup.sh
```

<details>
  <summary>What does this script do?</summary>
  <ol>
    <li><strong>Clone the Deployment Repository:</strong> Downloads all necessary configuration files from the CodeClarityCE deployment repository.</li>
    <li><strong>Start Docker Containers:</strong> Launches the core CodeClarity services using <code>docker-compose.yml</code>.</li>
    <li><strong>Download Database Dumps:</strong> Retrieves pre-populated database dumps with initial platform data.</li>
    <li><strong>Create Databases:</strong> Sets up the required databases for CodeClarity, ensuring a clean environment.</li>
    <li><strong>Restore Database Content:</strong> Loads the initial data into the databases.</li>
    <li><strong>Restart Containers:</strong> Restarts all services to apply changes and ensure everything is running correctly.</li>
  </ol>
</details>

### 2. Choose Your Installation Method

The setup script will guide you through two installation options based on your deployment environment:

#### Option 1: Local Development Installation 🏠

**Best for:** Development, testing, and local evaluation

The fastest way to get started with CodeClarity is to install it on your local machine. This option is perfect for:

- Evaluating CodeClarity's features
- Development and testing
- Quick proof-of-concept deployments

When prompted, select **localhost installation**:

```bash
Is this installation running on localhost (Y/n)?
Y
```

> [!NOTE]
> **What happens next:**
>
> - CodeClarity will be accessible at `https://localhost:443`
> - Self-signed certificates will be automatically generated
> - No external DNS configuration required

#### Option 2: Production/Server Installation 🌐

**Best for:** Production deployments, team environments, and public-facing instances

Choose this option when deploying CodeClarity on a server with a specific domain name.

First, decline the localhost option:

```bash
Is this installation running on localhost (Y/n)?
n
```

Then provide your domain name (must point to your server's IP address):

```bash
Enter the domain name (localtest.io):
your-domain.com
```

> [!IMPORTANT]
> **Prerequisites for domain installation:**
>
> - Your domain must be configured to point to your server's IP address
> - Ensure ports 80 and 443 are accessible from the internet (if using automatic certificates)

##### SSL Certificate Options

You have two options for SSL certificates:

###### Automatic Certificate Generation (Recommended) 🔐

Let Caddy automatically generate and manage SSL certificates via Let's Encrypt:

```bash
Do you want Caddy to generate certificates (Y/n)?
Y
```

> [!TIP]
> **Requirements for automatic certificates:**
>
> - Your server must be publicly accessible from the internet
> - Domain must resolve to your server's public IP
> - Ports 80 and 443 must be open
> - Let's Encrypt rate limits apply

###### Custom Certificate Management 📜

Use your own SSL certificates:

```bash
Do you want Caddy to generate certificates (Y/n)?
n
```

> [!NOTE]
> **Using custom certificates:**
>
> - The setup script will create placeholder certificates in the `certs` directory
> - Replace the generated certificates with your own before starting the platform
> - Restart the platform after replacing certificates: `docker compose restart`
> - Supported formats: PEM-encoded certificate and private key files

### 3. Update the Knowledge Database (Optional)

To keep your vulnerability database up to date, you can refresh it using the latest data from the National Vulnerability Database (NVD).

> [!NOTE]
> Apply for a free [NVD API key](https://nvd.nist.gov/developers/request-an-api-key) and add it to your `.env.codeclarity` file before updating.

**To update the knowledge database, run:**

```bash
make knowledge-update
```

This will download and import the latest vulnerability data, ensuring your platform has the most current security information.

### 4. Maintaining the Platform

After the initial setup, you can manage CodeClarity using standard Docker Compose commands—no need to rerun the setup script.

> [!NOTE]
> Common Docker Compose Commands
>
> - `docker compose up -d`: Start the platform in the background (detached mode).
> - `docker compose down`: Stop the platform and remove containers.
> - `docker compose restart`: Restart all platform containers.
> - `docker compose pull`: Download the latest Docker images from the repository.

> [!TIP]
> To update CodeClarity to the latest version:
>
> - `git pull`: Fetch the latest changes from the deployment repository.
> - `docker compose pull`: Download updated Docker images.
> - `docker compose restart`: Restart containers to apply updates.

> [!CAUTION]
> Your data is stored in Docker volumes and will persist between restarts. However, always back up your data before performing major updates.

## 🤝 Contributing

If you'd like to contribute code or documentation, please see [CONTRIBUTING.md](./CONTRIBUTING.md) for guidelines on how to do so.

## 🐛 Reporting Issues

Please report any issues with the setup process or other problems encountered while using this repository by opening a new issue in this project's GitHub page.

## 📄 License

This project is licensed under the AGPL-3.0-or-later license. You can find the full license details in the [LICENSE](./LICENSE) file.
